!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["video/player/extend-speed"]=t():e["video/player/extend-speed"]=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{component:function(){return G}});var n=coreApis.utils.urls,s=coreApis.settings,i=coreApis.utils.log,o=coreApis.pluginApis.hook;const r=e=>"function"==typeof e?{next:e}:e,a=e=>function e(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=!1;const a=[],l=[];let d=!1;const c=()=>{for(;a.length;)a.pop()();l.length=0,d=!0},p=e=>{d||(l.forEach((t=>{var n;null===(n=t.error)||void 0===n||n.call(t,e),(0,s.getGeneralSettings)().devMode&&console.error(e)})),c())},u=e=>{d||l.forEach((t=>{try{t.next(e)}catch(e){p(e)}}))},h=()=>{l.forEach((e=>{var t;null===(t=e.complete)||void 0===t||t.call(e)})),c()},m=()=>{if(o)return;const e=null==t?void 0:t({next:u,error:p,complete:h});e&&a.push(e),o=!0},b=e=>null==e?null:(l.push(e),()=>{lodash.pull(l,e)}),f=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return 0===n.length?{subscribe:e=>{const t=b(r(e));return((null==i?void 0:i.connect)??m)(),t},pipe:f,next:u,error:p,complete:h,...i}:e(n[0],{subscribe:b},i||{connect:m,next:u}).pipe(...n.slice(1))};if(n){const e=null==t?void 0:t({subscribe:e=>n.subscribe({error:p,complete:h,...r(e)}),next:u,error:p,complete:h});e&&a.push(e)}return f()}(e),l=(e,t)=>a((n=>{let{next:s}=n;return e.addEventListener(t,s),()=>e.removeEventListener(t,s)})),d=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];return a((t=>{let{next:s}=t;e(...n,s)}))},c=e=>new Promise(((t,n)=>{const s=e.subscribe({next:e=>{t(e),s()},error:()=>{n(),s()},complete:()=>{n(),s()}})}));var p=coreApis.componentApis.video.playerAgent,u=coreApis.lifeCycle,h=coreApis.observer,m=coreApis.utils,b=coreApis.utils.sort;const f=e=>t=>{let{subscribe:n,next:s,complete:i,error:o}=t;n(lodash.mapValues({next:s,complete:i,error:o},(t=>e(t))))},v=e=>function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];Promise.resolve().then((()=>e(...n)))},g=e=>{const t=new Set;return e((e=>{lodash.castArray(e).forEach((e=>{t.add(e)}))})),()=>{t.forEach((e=>{e()}))}},y=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a((e=>{let{next:n,error:s,complete:i}=e;return g((e=>{const o=[];let r=0;e(t.map(((e,a)=>e.pipe(f(v)).subscribe({next:e=>{o[a]=e,o.reduce((e=>e+1),0)===t.length&&n(o.slice())},complete:()=>{r++,r===t.length&&i()},error:s})))),e((()=>{o.length=0,r=0}))}))}))},x=e=>t=>{let{subscribe:n,next:s,error:i}=t;n(lodash.debounce((e=>{try{s(e)}catch(e){i(e)}}),e))},S=e=>t=>{let{subscribe:n,next:s}=t;n((t=>{e(t)&&s(t)}))},E=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{let{next:n,subscribe:s}=e,i=!1;s((e=>{i||t.forEach((e=>n(e))),n(e),i=!0}))}};var w=coreApis.pluginApis.data;const C=e=>e.replace(/^\./,""),V=(e,t)=>{const n=t=>{(0,w.registerAndGetData)(e,t)[0]=t},s=(0,w.getData)(e);if(s.length)return[s[0],n];if(t){const e=t();return n(e),[e,n]}return[void 0,n]},$=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t&&1===e?"倍速":Math.trunc(e)===e?`${e}.0x`:`${e}x`},M=e=>{if("倍速"===e)return 1;const t=/([0-9]*[.]?[0-9]+)x/.exec(e);if(t)return parseFloat(t[1]);throw new Error(`unknown speed text: ${e}`)};const L=p.playerAgent.provideCustomQuery({video:{speedMenuList:".bilibili-player-video-btn-speed-menu",speedMenuItem:".bilibili-player-video-btn-speed-menu-list",speedNameBtn:".bilibili-player-video-btn-speed-name",speedContainer:".bilibili-player-video-btn-speed",active:".bilibili-player-active",show:".bilibili-player-speed-show"},bangumi:{speedMenuList:".squirtle-speed-select-list",speedMenuItem:".squirtle-select-item",speedNameBtn:".squirtle-speed-select-result",speedContainer:".squirtle-speed-wrap",active:".active",show:".bilibili-player-speed-show"}});let A;!function(e){e[e.MIN=0]="MIN",e[e.CURRENT=1]="CURRENT",e[e.MAX=2]="MAX"}(A||(A={}));const k=(e,t,n)=>{const s=new MutationObserver(n);return s.observe(e,t),s},N=e=>{let[t,n]=e;if(!t)throw new Error("speed container element not found!");if(!n)throw new Error("video element not found!");const s=t.querySelector(L.custom.speedNameBtn.selector),i=t.querySelector(L.custom.speedMenuList.selector);let o,r,l;const d=a(),c=a().pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))}));c.pipe(E(void 0),(e=>{let{subscribe:t,next:n}=e;const s=[];return t((e=>{2===s.length&&s.shift(),s.push(e),2===s.length&&n(s.slice())})),()=>{s.length=0}})).subscribe((e=>{let[t,n]=e;r=t,o=n}));const p=e=>{if(e)switch(e.nodeType){case Node.TEXT_NODE:c.next(M(e.data));break;case Node.ELEMENT_NODE:c.next(M(e.innerHTML));break;default:console.warn("The target parameter of updateActiveVideoSpeed must be a Node, and the node type must be one of TEXT_NODE and ELEMENT_NODE")}},u=()=>{l=lodash([...i.children]).map((e=>lodash.attempt((()=>M(e.textContent))))).reject((e=>lodash.isError(e))).sort((0,b.ascendingSort)()).value()};p(s),u();const h=k(i,{childList:!0,attributes:!0},(e=>{const{attributes:t=[],childList:n=[]}=lodash.groupBy(e,"type");n.length&&u(),d.next({attributes:t,childList:n})})),f=k(s,{childList:!0,subtree:!0},(e=>{e.forEach((e=>{const[t]=e.addedNodes;p(t)}))}));return{containerElement:t,videoElement:n,nameBtnElement:s,menuListElement:i,query:e=>(0,m.des)(`./*[contains(@class, "${C(L.custom.speedMenuItem.selector)}") and normalize-space()="${$(e)}"]`,i),dispose:()=>{h.disconnect(),f.disconnect()},activeVideoSpeed$:c,menuListElementMutations$:d,getActiveVideoSpeed:()=>o,getOldActiveVideoSpeed:()=>r,getAvailableSpeedValues:()=>l}},O=e=>{const{videoElement:t,menuListElement:n}=e,s=l(n,"click").pipe((i=e=>{const{innerText:t,innerHTML:n}=e.target,s=t.trim()||n.trim();return lodash.attempt((()=>M(s)))},e=>{let{subscribe:t,next:n}=e;t((e=>{n(i(e))}))}),S((e=>!lodash.isError(e))));var i;const o=a((e=>{let{next:n}=e,s=t;do{s=Object.getPrototypeOf(s)}while(null===s||!Object.prototype.hasOwnProperty.call(s,"playbackRate"));const i=Object.getOwnPropertyDescriptor(s,"playbackRate");return Object.defineProperty(s,"playbackRate",{set(e){i.set.call(this,e),n(e)}}),()=>{Object.defineProperty(s,"playbackRate",i)}})),r=s.pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))})),d=o.pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))})),c=a((e=>{let{next:t}=e;const n=y(r,d);return n.subscribe((e=>{let[n,s]=e;n===s&&t(s)})),()=>n.complete()})).pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))}));let p;d.pipe(x(200),E(void 0),(e=>{let{subscribe:t,next:n}=e;const s=[];return t((e=>{2===s.length&&s.shift(),s.push(e),2===s.length&&n(s.slice())})),()=>{s.length=0}})).subscribe((e=>{let[t]=e;p=t}));const u={menuListElementClickSpeed$:s,menuListElementClickSpeedChange$:r,playbackRate$:o,playbackRateChange$:d,videoSpeedChange$:c};return{...e,...u,dispose:()=>{lodash.values(u).forEach((e=>{e.complete()})),e.dispose()},getOldPlaybackRate:()=>p}},[T]=V("speed.NoSuchSpeedMenuItemElementError",(()=>class extends Error{constructor(e){const t=lodash.attempt((()=>$(e))),n=lodash.isError(t)?String(e):String(t);var s,i,o;super(`There is no such speed menu item as ${n}`),this.speed=e,o=void 0,(i="formattedSpeed")in(s=this)?Object.defineProperty(s,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):s[i]=o,this.formattedSpeed=n}})),I=e=>{const{query:t,videoElement:n,videoSpeedChange$:s,getOldActiveVideoSpeed:i,getAvailableSpeedValues:o,getActiveVideoSpeed:r}=e,a=async function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;const o=t(e);if(null==o)throw new T(e);o.click();const r=t=>{if((t??n.playbackRate)!==e)throw new Error(`failed to set ${$(e)} video speed.`)},a=[c(s.pipe(x(Math.max(0,i||0))))];i>0&&a.push(new Promise(((e,t)=>setTimeout((()=>setTimeout(t,i)))))),await Promise.all(a).then(r).catch(r)},l=async()=>{await a(1)},d=async(e,t)=>{if(lodash.isNil(e)&&(e=!1),"boolean"==typeof e)e||1===n.playbackRate?await a(i()):await l();else{const n=o();switch(t){case A.MIN:await a(n[e]);break;case A.MAX:await a(n[n.length-1+e]);break;case A.CURRENT:default:{const t=n.indexOf(r());if(-1===t)throw new Error("Unexpected Error: The available speed values do not include the active speed value, this should be a bug, please report the issue on github!");await a(n[t+e])}}}},p=async e=>{try{await d(e,A.CURRENT)}catch(e){if(console.warn(e),!(e instanceof T))throw e}};return Object.assign(e,{set:a,force:async e=>{n.playbackRate=e},reset:l,toggle:d,step:p,increase:async()=>{await p(1)},decrease:async()=>{await p(-1)}})},R=()=>V("speed.speedContext"),j=()=>V("speed.buildArguments$",(()=>{return a().pipe((e=e=>e.settings.enabled,t=>{let{subscribe:n,next:s}=t;const i=new Set;return n((t=>{const n=i.size;e(t)?i.add(t):i.delete(t),i.size!==n&&s([...i])})),()=>{i.clear()}}));var e})),P=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lodash.identity;const[t,n]=R();if(t)return t;let s,i;const[o]=V("lifeCycleComponentLoaded$",(()=>l(unsafeWindow,u.LifeCycleEventTypes.ComponentsLoaded))),[r]=j(),[p]=V("speed.videoChange$",(()=>d(h.videoChange).pipe(S((e=>{let{aid:t,cid:n}=e;return t||n}))))),[m]=V("speed.speedContext$",(()=>a((t=>{let{next:n}=t;return y(p,r,o).subscribe((t=>{var o;let[r,a]=t;const[l]=R();null==l||l.dispose(),null===(o=i)||void 0===o||o("context update");const d=new Promise(((e,t)=>{s=e,i=t}));Promise.all([Promise.all([L.custom.speedContainer(),L.query.video.element()]).then(s),d]).then((e=>{let[,t]=e;return t})).then(N).then(O).then(I).then((e=>Object.assign(e,{videoIdObject:r,speedContext$:m,videoChange$:p}))).then(e(a)).then(n).catch((e=>console.error(e)))}))}))));return m.subscribe(n),c(m)};function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const U=[.5,.75,1,1.25,1.5,2],z=.0625;class H{constructor(e){var t;this.entryContext=e,q(this,"speedContext",void 0),q(this,"settings",void 0),q(this,"coreApis",void 0),q(this,"metadata",void 0),q(this,"options",void 0),q(this,"getVideoIdObject",void 0),q(this,"getAvailableSpeedValues",void 0),q(this,"getOldActiveVideoSpeed",void 0),q(this,"forceVideoSpeed",void 0),q(this,"getVideoSpeed",void 0),q(this,"setVideoSpeed",void 0),q(this,"resetVideoSpeed",void 0),q(this,"toggleVideoSpeed",void 0),q(this,"increaseVideoSpeed",void 0),q(this,"decreaseVideoSpeed",void 0),lodash.assign(this,e,{options:e.settings.options}),null===(t=this.migrate)||void 0===t||t.call(this),lodash.assign(this,lodash.mapValues(H.contextMap,(e=>async function(){const t=await P(),n=lodash.get(t,e),s=lodash.isFunction(n)?await n(...arguments):n;return s})))}}q(H,"create",void 0),q(H,"contextMap",{getVideoIdObject:"videoIdObject",getAvailableSpeedValues:"getAvailableSpeedValues",getOldActiveVideoSpeed:"getOldActiveVideoSpeed",getVideoSpeed:"videoElement.playbackRate",setVideoSpeed:"set",forceVideoSpeed:"force",resetVideoSpeed:"reset",toggleVideoSpeed:"toggle",increaseVideoSpeed:"increase",decreaseVideoSpeed:"decrease"}),P((e=>t=>{const n=lodash.omit(t,"dispose"),i=e.map((e=>e.getSpeedContextMixin(n)));if(i.length>1){const e=lodash.intersection(...i.map(Object.keys));if(e.length)throw new Error(`In the registered speed ​​component, there is an implementation of getSpeedContextMixin that causes the speed context to be mixed in ambiguous.\nThe repeated key names are ${e.join(", ")}`)}lodash.assign(n,...i);const o=[];return e.forEach((e=>{const t=lodash(e.settings.options).mapValues(((t,n)=>d(s.addComponentListener,`${e.metadata.name}.${n}`).pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))})))).mapKeys(((e,t)=>`${t}$`)).value();o.push(...lodash.values(t)),e.options=new Proxy(e.settings.options,{get:(e,n,s)=>lodash.isSymbol(n)?Reflect.get(e,n,s):!Reflect.has(e,n)&&n.endsWith("$")?t[n]:Reflect.get(e,n,s)}),e.speedContext=n,e.onSpeedContext(n),e.settings.enabled&&lodash(t).entries().forEach((t=>{let[n,s]=t;s.next(e.settings.options[n.slice(0,-1)])}))})),{...n,dispose:()=>{o.forEach((e=>e.complete())),t.dispose()}}})),H.create=function(e){const t=a().pipe((e=>{let t,{subscribe:n,next:s}=e,i=!0;n((e=>{(i||t!==e)&&(i=!1,t=e,s(e))}))}));return{...e,entry:n=>{const s=lodash.attempt((()=>new this(n)));if(s instanceof Error)return(0,i.logError)(s),null;const[r]=j();return t.subscribe((()=>{r.next(s)})),r.next(s),(0,o.getHook)(`speed.component.${e.name}`).after(s),s},reload:()=>t.next(!0),unload:()=>t.next(!1)}};var B=coreApis.style,D=coreApis.toast;const W=e=>{let t,{style:n,name:s,container:i}=e;const o=()=>{var e;return null===(e=t)||void 0===e?void 0:e.remove()};return{next:e=>{o();const r="function"==typeof n?n(e):n;r&&(t=(0,B.addStyle)(r,s,i))},complete:o}};function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const X=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=document.createElement("div");n.innerHTML=e;const s={},i=n.children.item(0),o=e=>{t&&(e.id=`scoped-element-${Math.random().toString(36).replace(/[^a-z0-9]+/g,"")}`);const n=e.getAttribute("data-ref");n&&(s[lodash.camelCase(n)]=e);for(let t=0;t<e.children.length;t++)o(e.children.item(t))};return o(i),{...s,root:i}};class _ extends H{constructor(){super(...arguments),F(this,"elementMap",[]),F(this,"inputElement",void 0),F(this,"unpatch",void 0),F(this,"currentSpeedValue",void 0),F(this,"filterNativeSpeed",(()=>e=>{let{subscribe:t,next:n}=e;t((e=>{U.includes(e)&&n(e)}))}))}static get activeClassName(){return C(L.custom.active.selector)}static get showClassName(){return C(L.custom.show.selector)}static get speedMenuItemClassName(){return C(L.custom.speedMenuItem.selector)}addSpeedValue(e){this.options.extendSpeedList=lodash.sortedUniq(this.options.extendSpeedList.concat(e).sort((0,b.ascendingSort)()))}removeSpeedValue(e){this.options.extendSpeedList=lodash.without(this.options.extendSpeedList,e)}createInputElement(){const{input:e,root:t,icon:n}=X(`\n      <li class="${C(L.custom.speedMenuItem.selector)} extend-speed-input">\n        <i data-ref="icon" class="mdi mdi-playlist-plus" style="font-size: 1.5em"></i>\n        <input data-ref="input" type="number" title="添加新的倍数值" max="16" step="0.5" style="display: none;"></input>\n      </li>\n    `),s=()=>{const t=this.speedContext.getAvailableSpeedValues().slice(-1)[0]+.5,n=lodash.toString(t>16?null:t);e.value=n,e.min=n};this.options.extendSpeedList$.pipe(f(v)).subscribe(s);const o=(0,B.addStyle)(`\n      #${e.id} {\n        font-size: inherit;\n        color: inherit;\n        line-height: inherit;\n        background: transparent;\n        outline: none;\n        width: 100%;\n        border: none;\n        text-align: center;\n        cursor: text;\n      }\n      /* https://stackoverflow.com/a/4298216 */\n      /* Chrome */\n      #${e.id}::-webkit-outer-spin-button,\n      #${e.id}::-webkit-inner-spin-button {\n        -webkit-appearance: none;\n        margin: 0;\n      }\n      /* Firefox */\n      #${e.id}[type=number] {\n        -moz-appearance:textfield;\n      }\n    `),r=lodash.over(l(e,"keydown").pipe(x(200)).subscribe((t=>{let{key:n}=t;if("Enter"!==n)return;const s=parseFloat(e.value);try{if(!lodash.isFinite(s))throw new Error("无效的倍数值");if(s<z)throw new Error("倍数值太小了");if(s>16)throw new Error("倍数值太大了");if(this.speedContext.getAvailableSpeedValues().includes(s))throw new Error("不能重复添加已有的倍数值");this.addSpeedValue(s)}catch(t){(0,i.logError)(String(t),5e3),e.focus(),e.select()}})),l(t,"mouseenter").subscribe((()=>{e.style.display="inline",n.style.display="none",s(),setTimeout((()=>e.focus()))})),l(t,"mouseleave").subscribe((()=>{e.style.display="none",n.style.display="inline"})),(()=>t.remove()),(()=>o.remove()));return{node:t,destroy:r}}createCustomSpeedMenuItemElement(e){const{closeBtn:t,root:n}=X(`\n      <li class="${C(L.custom.speedMenuItem.selector)} extend-speed-item">\n        ${$(e)}\n        <i data-ref="close-btn" class="mdi mdi-close-circle"></i>\n      </li>\n    `),s=(0,B.addStyle)(`\n      .extend-speed-item [data-ref="close-btn"] {\n        color: inherit;\n        opacity: 0.5;\n        display: none;\n        position: absolute;\n        right: 4px;\n      }\n      ${L.custom.speedMenuItem.selector}:not(${L.custom.active.selector}):hover [data-ref="close-btn"] {\n        display: inline;\n      }\n      .extend-speed-item [data-ref="close-btn"]:hover {\n        opacity: 1;\n        transition: all .3s;\n      }\n    `),i=lodash.over(l(t,"click").subscribe((()=>{this.removeSpeedValue(e)})),(()=>n.remove()),(()=>s.remove()));return{tag:e,node:n,destroy:i}}migrate(){const{options:e}=this.settings,{options:t}=(0,s.getComponentSettings)("rememberVideoSpeed");t.extendList&&(e.extendSpeedList=Array.from(t.extendList),delete t.extendList,delete t.extend,D.Toast.success("从「倍速记忆」组件迁移旧配置成功","【扩展倍速】旧配置迁移完成",8e3))}// eslint-disable-next-line class-methods-use-this
getSpeedContextMixin(e){let{menuListElement:t}=e;return{query:e=>(0,m.des)(`./*[contains(@class, "${_.speedMenuItemClassName}") and not(contains(@class, "extend-speed-input")) and normalize-space()="${$(e)}"]`,t)}}onSpeedContext(e){let{menuListElementClickSpeedChange$:t,menuListElementMutations$:n,playbackRate$:s,menuListElement:i}=e;this.options.extendSpeedList$.subscribe({next:e=>this.patch(((e,t)=>{let n=0,s=e.length,i=0,o=t.length;for(;n<s&&i<o&&e[n]===t[i];)n++,i++;for(;n<s&&i<o&&e[s-1]===t[o-1];)s--,o--;return[n,s-n,t.slice(i,o)]})(this.elementMap.map((e=>e.tag)),Array.from(e))),complete:()=>{this.unpatch()}}),this.options.maxMenuHeight$.subscribe(W({name:"extend-video-speed-style",style:e=>`\n                  ${L.custom.speedMenuList.selector} {\n                    display: flex;\n                    flex-direction: column;\n                    overflow-y: auto;\n                    max-height: ${e}px;\n                  }`})),this.options.hideScrollbar$.subscribe(W({name:"extend-video-speed-no-scrollbar-style",style:e=>e&&`\n                ${L.custom.speedMenuList.selector} {\n                  scrollbar-width: none !important;\n                  overscroll-behavior: contain;\n                }\n                ${L.custom.speedMenuList.selector}::-webkit-scrollbar {\n                    height: 0 !important;\n                    width: 0 !important;\n                }`}));let o=1;s.pipe(S((e=>U.includes(e)))).subscribe((e=>{o=e})),t.subscribe({next:e=>{this.forceVideoSpeedWithUpdateStyle(e),this.currentSpeedValue=e},complete:()=>{this.setVideoSpeed(o),this.forceVideoSpeedWithUpdateStyle(o)}}),n.subscribe((e=>{let{attributes:t}=e;t.forEach((e=>{if("style"===e.attributeName){const{display:e}=unsafeWindow.getComputedStyle(i);"block"===e&&(i.style.display="flex")}}))})),this.currentSpeedValue&&requestIdleCallback((()=>{this.setVideoSpeed(this.currentSpeedValue,1e3)}))}async forceVideoSpeedWithUpdateStyle(e){await this.forceVideoSpeed(e),setTimeout((()=>this.forceUpdateStyle(e)))}patch(e){const[t,n,s]=e,{menuListElement:i}=this.speedContext;if(this.inputElement||(this.inputElement=this.createInputElement(),i.prepend(this.inputElement.node)),0===n&&0===s.length)return;const o=s.map((e=>this.createCustomSpeedMenuItemElement(e)));this.elementMap.splice(t,n,...o).forEach((e=>{e.destroy()})),(this.elementMap[t-1]||this.inputElement).node.after(...o.map((e=>e.node)).reverse()),i.querySelectorAll(`${L.custom.speedMenuItem.selector}:not(#${this.inputElement.node.id})`).forEach((e=>{e.style.order=(1e4*(16-M(e.innerHTML))).toString()})),this.unpatch=()=>{this.inputElement.destroy(),this.inputElement=void 0,this.elementMap.forEach((e=>e.destroy())),this.elementMap.length=0}}forceUpdateStyle(e){const{menuListElement:t,containerElement:n,nameBtnElement:s,query:i}=this.speedContext;for(const e of(0,m.dea)(`./*[contains(@class, "${_.speedMenuItemClassName}") and contains(@class, "${_.activeClassName}")]`,t))e.classList.remove(_.activeClassName);i(e).classList.add(_.activeClassName),n.classList.remove(_.showClassName),s.innerText=$(e,!0)}}const G=_.create({name:"extendVideoSpeed",displayName:"扩展倍速",author:{name:"JLoeve",link:"https://github.com/LonelySteve"},description:{"zh-CN":"\n\n> 扩展视频播放器的倍速菜单项，可用于突破原有播放倍数的上限或下限.\n\n### 🔧 **选项**\n\n- `隐藏滚动条`：如果添加的倍速过多，倍速菜单将出现滚动条，在 Windows 下，若没有安装并启用「细滚动条」组件会显得比较挤，建议开启此选项隐藏滚动条.\n\n### **新增倍速**\n\n开启组件后，在默认情况下，播放器的倍速菜单就会新增 2.5x 和 3.0x 两个倍速选项.\n\n如果需要添加更多倍速，只需将鼠标指针移到菜单顶部的新增图标上，图标将变成一个输入框，根据需要键入新的倍速值，或通过滚轮增减数值，或直接使用推荐的数值，回车确认即可.\n\n新增倍速的范围要求在 0.0625 到 16 之间，数量则不受限制.\n\n**不推荐设置超高倍速（>3.0x）**：原生播放器内部没有针对超高倍速进行优化，可能导致音画不同步、播放卡顿、声音嘈杂/消失等一系列问题.\n\n### **删除倍速**\n\n将鼠标指针移到**自定义**的倍速菜单项上，其右侧将会显示一个移除图标，单击即可删除相应的倍速.\n\n"},tags:[componentsTags.video],urlInclude:n.playerUrls,options:{maxMenuHeight:{displayName:"倍速菜单最大高度",defaultValue:360,hidden:!0,validator:e=>Math.max(parseInt(e),360)||360},hideScrollbar:{displayName:"隐藏滚动条",defaultValue:!1},extendSpeedList:{displayName:"扩展倍速列表",defaultValue:[2.5,3],hidden:!0}},commitHash:"73fa9af28753b2618111f03f5b8f37ef7a4f6281",coreVersion:"2.1.10"});return t=t.component}()}));